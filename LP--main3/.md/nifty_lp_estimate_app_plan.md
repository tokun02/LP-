# 📘 NIFTY × Next.js 無料LP見積アプリ企画書

<!-- 最終更新: 2025-10-30 06:15 -->
<!-- 変更履歴: 2025-10-30 - 第2版: 文書構成を再設計し、KPI・技術方針・リスクマネジメントを追記 -->

## 1. プロジェクトサマリー
### 1.1 プロダクトビジョン
- LP制作に必要なヒアリング・見積・PDF出力を60秒以内で完結できる自動見積SaaSを無償提供し、制作事業者の案件獲得に貢献する。
- 技術的な信頼性と透明性を備え、将来的な有料拡張（請求書、決済連携）へスムーズに拡張できる基盤を構築する。

### 1.2 背景
- フリーランス・小規模制作会社では、Excelテンプレートや属人的な計算式に依存した見積作業が多く、工数集計やオプション料金の説明が非効率。
- クラウドストレージにバラバラに保存された履歴では、金額の整合性やロジックの再利用が難しい。
- NIFTY Cloudの無料枠とNext.jsのSSR/SSGを組み合わせることで、低コストかつ高速に公開できる差別化されたポートフォリオ施策となる。

### 1.3 ペルソナ
| ペルソナ | 属性 | 直面する課題 | 成功指標 |
|----------|------|--------------|----------|
| P1. フリーランスWEBデザイナー | 30代前半、受託中心 | 作業原価と提示金額の乖離、提案スピードの遅さ | 1クリックで見積書を生成し、提案リードタイムを1日以内に短縮 |
| P2. 制作会社の営業担当 | 20代後半、5名規模のチーム | 工数試算のばらつき、社内共有テンプレートの更新遅延 | チーム共通の料金テーブルを保持し、案件ごとの粗利率を可視化 |
| P3. 学生クリエイター | インターン・副業志向 | 市場価格の把握ができず、クライアント交渉が不安 | ベンチマーク付きの金額サマリを提示し、信頼を獲得 |

---

## 2. 提供価値と差別化戦略
### 2.1 価値仮説
- 見積作業の自動化により、平均30分のヒアリング整理時間を10分未満に短縮できる。
- 単価根拠を可視化することで、クライアントへの説明コストを削減し、受注率を10%以上向上させる。
- 匿名利用とクラウド保存を両立することで、試用段階の心理的抵抗を下げ、紹介経由の利用拡大を狙う。

### 2.2 差別化要素
| 項目 | 従来ツール | 本アプリ |
|------|------------|----------|
| 見積ロジック | Excelでの手動計算、属人的なマクロ | タリフテーブルと機能構成をデータドリブンに管理し、即時計算 |
| ストレージ | ローカルまたは不統一なクラウド保存 | NIFTY Object StorageでJSON管理、署名付きURLで安全共有 |
| UX | テンプレート入力中心で遷移が多い | セクション別のプログレッシブ入力とリアルタイムプレビュー |
| 技術アピール | 技術的な裏付け紹介が限定的 | Next.js + Tailwind + mBaaS構成を可視化し、案件獲得に利用可能 |

### 2.3 成功指標（KPI）
| 区分 | 指標 | 基準値 | 2026Q1目標 | 計測方法 |
|------|------|--------|-------------|----------|
| リーディング | 初回訪問→見積生成完了率 | 35% | 55% | Web Analytics / イベントトラッキング |
| リーディング | 見積生成までの平均時間 | 12分 | 4分 | Session Recording |
| ラグ | 署名付きURL経由の共有数/月 | 0 | 50 | NIFTY Cloud ログ |
| ラグ | 作成されたPDFのDL数 | なし | 120/月 | react-pdfアクセスログ |

---

## 3. プロダクトスコープ
### 3.1 コア機能一覧
| ID | 機能名 | 概要 | リリース枠 |
|----|--------|------|------------|
| F01 | ヒアリングシート入力 | ゴール/ターゲット/構成/オプションをセクション化した入力フォーム | MVP |
| F02 | 見積計算エンジン | タリフテーブル、オプション係数、税率を組み合わせた即時計算 | MVP |
| F03 | PDF生成 | ブランドテンプレートに沿った見積PDFの生成とダウンロード | MVP |
| F04 | 保存・復元 | ローカル自動保存 + NIFTY Cloudへの匿名保存 | MVP |
| F05 | 共有リンク発行 | 署名付きURL発行と有効期限管理 | MVP |
| F06 | 料金テーブル編集 | 管理者向けの料金テーブル編集UI | PoC |
| F07 | 指標ダッシュボード | 利用状況の可視化とレポート出力 | PoC |

### 3.2 非スコープ（今回含めない）
- クレジットカード決済、請求書発行、CRM連携などの商用化機能。
- 顧客固有ドメインによるホワイトラベル配信。
- 多人数同時編集、アクセス権限の細分化。

### 3.3 ロードマップ（暫定）
| フェーズ | 期間 | ハイライト | 成果物 |
|----------|------|------------|--------|
| Phase 0 | 〜2025/11 | 料金テーブル設計、UIプロトタイプ | ワイヤーフレーム、料金表 |
| Phase 1 | 2025/11〜2025/12 | MVP実装・内部検証 | Next.js MVP、単体テスト |
| Phase 2 | 2026/01 | β公開、利用計測 | Vercelデプロイ、計測設定 |
| Phase 3 | 2026/02〜 | 料金編集・ダッシュボード拡張 | 管理画面、分析基盤 |

---

## 4. 技術アプローチ
### 4.1 アーキテクチャ概要
- Next.js App Routerを用いて、ヒアリングフォームはClient Components、見積結果計算はServer Actionsで実行し、セキュアに料金テーブルを参照する。
- Zustandでフォーム状態を管理し、計算エンジンに送るデータを整形。PDF生成はサーバー側でreact-pdfを用いて行い、署名付きURL経由で配布。
- データ永続化はNIFTY Cloud mBaaSのData Storeを利用し、匿名ユーザーIDと案件トークンを紐づける。

### 4.2 採用技術スタック
| レイヤー | 技術 | 理由 |
|----------|------|------|
| フロントエンド | Next.js 14 (App Router) | SSR/SSGの柔軟な切替と高速開発 |
| UI | Tailwind CSS + shadcn/ui | コンポーネント駆動で一貫したUI構築 |
| 状態管理 | Zustand + React Hook Form | ストアのシリアライズが容易で再利用性が高い |
| PDF | react-pdf + Cloud Functions | ブラウザ依存なくA4/レター両対応の出力 |
| バックエンド | NIFTY Cloud mBaaS Data Store / Functions | 認証不要で使える軽量APIとスキーマレスな保管 |
| インフラ | Vercel + Cloudflare DNS | グローバル配信と無料枠での高速応答 |
| モニタリング | Vercel Analytics / Sentry | UX指標とエラー検知を即時確認 |

### 4.3 外部連携・予定
- NIFTY Cloud mBaaS REST API（データ登録、ファイル保存、サーバー関数）。
- Google Analytics 4 および Server-side Tagging によるイベント計測。
- Slack Incoming Webhookによるエラー・重要イベント通知。

---

## 5. UX指針
- ステップ型フォーム（Progressive Disclosure）で入力項目を段階的に表示し、離脱率を低減。
- 金額根拠をリアルタイム表示し、各項目にツールチップで説明を添付。
- PDFテンプレートはブランドカラーとロゴ差し替え対応が可能な設計にする。
- Lighthouse Performance 90点以上、Core Web Vitals「Good」判定を必須とする。

---

## 6. 体制とプロジェクト管理
| 役割 | 人数 | 主な責務 |
|------|------|----------|
| プロダクトオーナー | 1 | 要件優先度決定、ステークホルダー調整 |
| テックリード | 1 | 技術選定、設計レビュー、CI/CD整備 |
| フロントエンドエンジニア | 2 | Next.js開発、UI実装、テスト |
| QAエンジニア | 1 | テスト計画策定、品質ゲート運用 |
| デザイナー | 1 | 情報設計、ビジュアルガイドライン作成 |
| テクニカルライター | 1 | ナレッジ整備、PDFテンプレート文案 |

- タスク管理はLinearを使用し、2週間スプリントでJIRA互換のステータストラッキングを実施。
- CI/CDはGitHub ActionsでLint/Test/Build/PDF生成スナップショットを自動化。

---

## 7. コストとリソース試算（概算）
| コスト区分 | 内訳 | 月額概算 | 備考 |
|------------|------|----------|------|
| インフラ | Vercel Hobby、NIFTY Cloud無料枠 | 0円 | MVP段階では無料範囲内 |
| 運用 | ドメイン、外部計測ツール有料枠 | 1,500円 | ドメイン + GA4 BigQuery Export見込み |
| 人件費 | 6名 × 0.3人月 | 約90万円 | 受託・案件獲得用の先行投資 |

---

## 8. リスクと対策
| リスク | 影響 | 対策 |
|--------|------|------|
| 無料枠超過によるコスト発生 | 中 | 利用状況ダッシュボードでAPIコール数を監視し、閾値で通知 |
| PDF生成のレイアウト崩れ | 中 | Storybook + visual regression testでテンプレートを自動検証 |
| 匿名利用による悪用 | 低 | Rate Limiter、reCAPTCHA EnterpriseでBot制御 |
| 料金テーブルの陳腐化 | 中 | 半期ごとの市場調査、Git管理の料金テーブル定義 |

---

## 9. 次のアクション
1. 料金テーブル定義と係数設計の確定（2025/11/05まで）。
2. ワイヤーフレームとコンポーネントリストの合意（2025/11/07まで）。
3. 技術スパイク（PDF生成、NIFTY Cloud APIラッパー）を実施し、検証レポートを共有。
4. Linear上でスプリント0のバックログ整備、およびCIテンプレートの初期設定。
5. βテストに参加する制作パートナー3社の選定とMoU締結。

---

## 10. 開発環境セットアップ（WSL向け）
本プロジェクトをWSL2（Ubuntu等）で起動するための手順を記載する。

### 10.1 事前準備
- WSL2 と Ubuntu ディストリビューションをインストール済みであること。
- Git と Node バージョンマネージャ（例：`n`）を利用可能にしておく。

### 10.2 Node.js 22 系への切り替え
```bash
# n のインストール（未導入の場合）
curl -fsSL https://raw.githubusercontent.com/tj/n/master/bin/n | bash -s lts

# Node 22 系を導入
sudo n 22

# パスを通す（必要に応じて）
export PATH="$HOME/.n/bin:$PATH"
node -v  # v22.x.x を確認
```

### 10.3 依存関係の導入
```bash
# リポジトリルートで実行（WSLの作業ディレクトリへ移動してから）
pnpm install
```

### 10.4 環境変数の設定
- `apps/lp-estimate/.env` を作成し、`.env.example` を参考に以下を設定する。
  - `NETLIFY_BLOBS_TOKEN`（Netlifyで発行したトークン）
  - `SHARE_SECRET`（16文字以上のランダム文字列）

初回はローカル用トークンを取得して `.env` に入れておくと便利。
```bash
# 例：Netlify CLI が導入済みの場合の取得イメージ（環境に応じて読み替え）
netlify blobs:token
```

### 10.5 開発サーバの起動
```bash
# モノレポのルートで
pnpm dev

# もしくは対象アプリのみ
pnpm --filter lp-estimate dev
```

ブラウザで `http://localhost:3000` にアクセスして動作を確認する。

### 10.6 トラブルシューティング（WSL）
- Windows側ポートの競合: `netstat -ano | findstr :3000` で確認し、競合プロセスを停止。
- ファイル監視の制限: 大規模変更時は `CHOKIDAR_USEPOLLING=1` を一時的に付与して起動。
- 改行コードの警告: Gitのautocrlf設定を見直すか、WSL内のクローンを推奨。

### 10.7 Netlify CLI の導入とトークン反映
Netlify Blobs をローカル検証するために CLI を導入し、取得したトークンを `.env` に反映する。

```bash
# Netlify CLI のインストール
pnpm dlx netlify-cli --version  # 事前確認（未導入なら次へ）
pnpm add -D netlify-cli

# ログイン（ブラウザで承認）
npx netlify login

# Blobs トークンの発行
npx netlify blobs:token
```

上記で表示されたトークンを `apps/lp-estimate/.env` に設定する。

```bash
# apps/lp-estimate/.env
NETLIFY_BLOBS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SHARE_SECRET=please-change-to-16chars-or-more
```

補足:
- リポジトリに `.env` をコミットしないこと（.gitignore で除外済み）。
- トークン権限は最小にし、不要になったら Netlify 側で失効させる。

### 10.8 パフォーマンス（next dev のCPU負荷対策）
- キャッシュ活用: `node_modules/.cache` はWSL内に置き、Windows側の巨大ディレクトリ参照を避ける。
- Turbo最適化: Next.js 14 以降は `next dev --turbo` を検討（環境により効果差あり）。

```bash
# 通常起動
pnpm --filter lp-estimate dev

# Turbo を試す（計測して良否を判断）
pnpm --filter lp-estimate dev -- --turbo
```

- ウォッチ負荷軽減: 大量ファイル変更時は一時的に `CHOKIDAR_USEPOLLING=1` を付与。

```bash
CHOKIDAR_USEPOLLING=1 pnpm --filter lp-estimate dev
```

- メモリ/CPU: `.wslconfig` で WSL の `memory` と `processors` を明示し、スロットリングを回避。

### 10.9 開発品質（WSLでの lint/test/build フロー）
推奨フロー:

```bash
# 依存解決（初回/更新時）
pnpm install

# 型・静的解析
pnpm lint

# 単体テスト（モノレポ全体）
pnpm test

# 対象アプリのみテスト
pnpm --filter lp-estimate test

# ビルド検証
pnpm build

# 対象アプリのみビルド
pnpm --filter lp-estimate build
```

注意点（WSL）:
- ファイル監視の差異でテストのスナップショット更新タイミングがズレることがあるため、`git status` で差分を都度確認。
- 改行コードの混在を避けるため、WSL内で編集・コミットする運用を推奨（`core.autocrlf=input`）。
- CI 互換性を保つため、Node/PNPM のバージョンを `.node-version` / `packageManager` に合わせる。
