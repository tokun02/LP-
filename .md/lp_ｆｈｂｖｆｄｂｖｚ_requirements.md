# 📄 LP制作見積アプリ 拡張要件書（FH Spec）

<!-- 最終更新: 2025-10-30 05:09 -->
<!-- 変更履歴: 2025-10-30 - 第2版: 高度要件と技術的施策を再定義し、観測性・AI連携を追記 -->

## 1. 文書の位置づけ
- 本書はMVP以降に実装する高度機能（Future Horizon）について、要求水準と技術的検討事項を整理する。
- 料金モデルの多様化、チームコラボレーション、AI活用など、中期ロードマップの検討材料とする。

## 2. 追加価値と狙い
| 提供価値 | 説明 | 想定インパクト |
|----------|------|----------------|
| チームコラボレーション | 複数メンバーが案件を共同編集し、履歴を管理 | 見積精度の向上、教育コスト削減 |
| ダイナミックプライシング | 市場データや過去案件から推奨単価を算出 | 粗利の最大化、提示根拠の強化 |
| 自動見積レビュー | AIが入力内容をチェックし、抜け漏れやリスクを警告 | 誤見積の削減、品質向上 |
| 観測性強化 | 利用状況・成約率を可視化し、改善サイクルを高速化 | KPIの継続改善 |

---

## 3. 拡張機能カテゴリ
| カテゴリ | 機能名 | 概要 | 技術的ポイント | 優先度 |
|----------|--------|------|----------------|--------|
| Collaboration | リアルタイム共同編集 | WebSocketでフォーム状態を同期し、ロック/マージを制御 | CRDTを利用した楽観的マージ | High |
| Pricing Intelligence | 推奨単価エンジン | 過去案件・市場指数をもとに推奨価格を提示 | Python LambdaでMLモデル推論、キャッシュ層 | High |
| Workflow Automation | 承認フロー | 顧客提出前にチーム承認を経てPDFをロック | ワークフローエンジン（Temporal等）の導入検討 | Medium |
| Auditability | 詳細履歴管理 | フィールドごとの変更履歴・差分比較を提供 | Event Sourcing、Change Data Capture | Medium |
| Integrations | Slack/Notion連携 | 案件ステータスや見積書を外部ツールへ通知 | Zapier/GAS/Webhookのアダプタ | Medium |
| Compliance | 電子署名連携 | PDFへの電子署名付与と証跡管理 | CloudSign APIなどの連携 | Low |

---

## 4. 技術アーキテクチャ検討
### 4.1 システム構成案
- Next.jsを継続利用しつつ、エッジ配信（Vercel Edge Middleware）で署名URL検証やジオフェンス制御を行う。
- リアルタイム機能はAblyまたはSupabase Realtimeを比較検証し、コスト/レイテンシ/実装工数を評価する。
- 推奨単価モデルはPythonベースの推論APIをCloud Functionsで運用し、料金テーブルとの整合性を保つ。

### 4.2 データアーキテクチャ
| 層 | 技術/サービス | 役割 |
|----|----------------|------|
| オペレーショナル | NIFTY DataStore（既存） | 案件・タリフ・共有トークンの永続化 |
| ストリーム | EventBridge互換サービス | 変更イベントをリアルタイム配信 |
| 分析 | BigQuery互換（将来） | 料金傾向分析、ML学習データセット |
| キャッシュ | Cloudflare KV / Upstash Redis | 推論結果や料金テーブルのキャッシュ |

### 4.3 APIレイヤー
- GraphQL Gatewayを追加し、フロントからの取得効率を改善。BFF層で認可ポリシーを制御。
- Webhook管理サービスを設け、外部連携時の再送制御と署名検証を厳格化。

---

## 5. AI活用シナリオ
| ID | シナリオ | 入力 | 出力 | 成功指標 |
|----|----------|------|------|----------|
| AI-01 | 推奨単価提案 | 過去案件データ、業種、ページ構成 | 推奨単価、信頼度、根拠コメント | 60%以上のユーザーが推奨単価を採用 |
| AI-02 | 入力補助 | フリーテキストの要約 | ペルソナ/USPの整理 | 入力完了時間を20%短縮 |
| AI-03 | リスク検知 | 見積明細、納期 | リスクタグ、改善提案 | 提示されたリスクの50%以上が有用と評価 |

AIサービス候補:
- OpenAI GPT-4.1 / Azure OpenAI（データ保持ポリシー要確認）
- Bedrock Claude 3.x（JPリージョン対応時）
- Hugging Face Hub（オンプレモデル評価時）

---

## 6. セキュリティ・コンプライアンス強化
- RBAC（Role Based Access Control）を導入し、閲覧・編集・承認権限を分離。
- 共有リンクのアクセスログを継続的に収集し、異常なアクセスパターンを検出。
- 電子帳簿保存法を意識した見積書保管（タイムスタンプ、改ざん検知）を実装。
- ISO/IEC 27001取得を前提に、開発プロセスにセキュリティレビューを組み込む。

---

## 7. 観測性とSRE
| 項目 | 施策 | 指標 |
|------|------|------|
| メトリクス | OpenTelemetryでフロント/バックのトレースを収集し、Grafanaに可視化 | Apdex 0.9以上 |
| ログ | Structured Logging（JSON）でCloud Loggingに集約 | エラー検出3分以内 |
| アラート | SLO違反時にPagerDutyへ通知。Slackに自動要約を投稿 | SLO違反対応開始まで5分以内 |
| カオスエンジニアリング | 月次でレートリミット超過・API失敗のシナリオテストを実施 | 復旧時間15分以内 |

---

## 8. ロードマップ案
| フェーズ | 期間 | 主な成果物 | 前提条件 |
|----------|------|------------|----------|
| FH-1 | 2026 Q2 | 推奨単価エンジンβ、料金ダッシュボード | 料金テーブルの正確性確保 |
| FH-2 | 2026 Q3 | コラボレーション、承認フロー | Realtime基盤の採用決定 |
| FH-3 | 2026 Q4 | AIレビュー、電子署名連携 | 法務・セキュリティ評価完了 |

---

## 9. 開発プロセスへのインパクト
- Jira/Linearのワークフローを拡張し、アーキテクチャレビューとセキュリティレビューを必須ステップ化。
- Feature Flag（LaunchDarkly等）の導入を前提に、段階的ロールアウトを実施。
- バックエンド/AIコンポーネントは別リポジトリ化を検討し、マイクロサービス化の布石とする。

---

## 10. 未決事項
| 項目 | 検討内容 | 担当 | 期限 |
|------|----------|------|------|
| リアルタイム基盤 | Supabase RealtimeとAblyの比較検証 | テックリード | 2025/12/15 |
| AIリスク評価 | 外部ベンダーとのデータ取り扱い契約 | プロダクトオーナー | 2026/01/10 |
| 料金データ連携 | 外部価格データ取得方法（スクレイピング/提携） | 事業開発G | 2026/01/20 |
| コンプライアンス | 電子署名の法的要件調査 | 法務 | 2026/02/05 |

---

本拡張要件は、MVPの利用状況・顧客ヒアリングを踏まえて優先順位を再評価する。各機能の実装前にはスパイクを実施し、コストとリスクを数値化した上でGo/No-Go判断を行う。
