# 📄 LP制作見積アプリ 要件定義書

<!-- 最終更新: 2025-10-31 02:40 -->
<!-- 変更履歴: 2025-10-31 - ヒアリングシート拡充案を追加（重複整理・UI指針） -->
<!-- 変更履歴: 2025-10-30 - 第2版: 文字化けを解消し、機能要件・非機能要件・受入基準を詳細化 -->

## 1. 文書概要
### 1.1 目的
- LP制作見積アプリ（以下「本システム」）の開発に向けて、機能要件・非機能要件・制約条件を整理し、関係者間で合意する。
- MVPリリース範囲を明確にし、追加開発や将来拡張の判断材料を提供する。

### 1.2 スコープ
- Webブラウザ上で動作するNext.js製アプリケーション。
- ユーザーは匿名で利用可能だが、JSONデータとして案件を保存・共有できる。
- PDF出力、料金計算、共有リンク生成など、本システム内で完結するワークフローを対象とする。

### 1.3 参照資料
- 
ifty_lp_estimate_app_plan.md
- lp_estimate_app_design_specification.md
- NIFTY Cloud mBaaS 公式ドキュメント

---

## 2. ステークホルダー
| 役割 | 氏名/部署 | 関心事 | 意思決定レベル |
|------|-----------|--------|----------------|
| プロダクトオーナー | 制作事業部長 | プロダクト方向性、KPI達成 | 承認者 |
| テックリード | 受託開発G | 技術選定、品質基準 | 承認者 |
| デザイナー | クリエイティブ室 | UX/UI整合性、ブランド表現 | 協議者 |
| フロントエンドエンジニア | 開発チーム | 実装容易性、テスト可能性 | 実装責任 |
| QAエンジニア | 品質保証室 | 受入基準、テスト計画 | 協議者 |
| 利用ユーザー代表 | フリーランス3名 | 価値体験、フィードバック | 参考意見 |

---

## 3. 定義・略語
| 用語 | 定義 |
|------|------|
| ヒアリングシート | 案件情報を入力するマルチステップフォーム。
| タリフテーブル | 項目ごとの単価・係数を保持する参照データ。
| 案件トークン | 匿名利用者と案件を紐づけるUUID。
| 署名付きURL | 期限付きで見積結果を共有するためのURL。
| MVP | Minimum Viable Product。本フェーズのリリース範囲。

---

## 4. 前提・制約条件
- 対応ブラウザはChrome/Edge/Safari/Firefoxの最新版から2世代以内。
- バックエンドはNIFTY Cloud mBaaSを利用し、独自サーバーは構築しない。
- 無料枠内でAPIコール/ストレージ容量を収める実装とする。
- ユーザー登録やログインは提供せず、匿名IDで利用履歴を管理する。
- 料金テーブルはGit管理されたJSONをデプロイ時にバンドルし、Server Actionsから読み込む。

---

## 5. 現状課題とTo-Be像
### 5.1 現状課題（As-Is）
- 工数換算が個人メモやExcel依存で標準化されていない。
- 言語化が苦手なクライアントに対するヒアリング項目が不足している。
- 見積の履歴が散逸し、提案根拠の再利用が困難。

### 5.2 To-Be
- 必須情報をフォームでガイドし、ヒアリング漏れを防止する。
- 金額ロジックをデータ化し、即時プレビューで根拠を提示する。
- PDFと共有リンクで顧客への配布コストを削減し、履歴を匿名IDで保管する。

### 5.3 成功条件
- MVP公開3か月で、テストユーザー10名中7名が継続利用を希望する。
- 料金テーブルの更新がPull Request経由で48時間以内に反映できる。
- 1案件あたりの見積作成時間が平均12分以下となる。

---

## 6. 機能要件
### 6.1 ユースケース一覧
| UC ID | 名称 | 主要アクター | トリガー | 成功条件 |
|-------|------|--------------|----------|----------|
| UC01 | ヒアリング項目の入力 | 見積作成者 | 新規案件を開始 | 必須項目がバリデーションを通過し、保存できる |
| UC02 | 見積金額の確認 | 見積作成者 | 入力内容を変更 | 計算結果が即時に更新され、各項目の根拠が表示される |
| UC03 | PDF出力 | 見積作成者 | PDF生成を要求 | PDFがダウンロードでき、レイアウト崩れがない |
| UC04 | 案件の保存 | 見積作成者 | 保存ボタン | NIFTY Cloudに案件トークンとデータが保全される |
| UC05 | 共有リンクの発行 | 見積作成者 | URL共有を選択 | 有効期限付きの署名URLが得られる |

### 6.2 機能要件テーブル
| ID | 機能 | 詳細 | 優先度 | 受入条件 |
|----|------|------|--------|------------|
| F-01 | マルチステップフォーム | 基本情報、構成、オプション、費用サマリの4ステップ。任意項目でも入力状態を保持。 | Must | Chrome/Edgeで操作でき、タブ移動時にデータが保持される |
| F-02 | バリデーション | 必須項目、文字数、数値範囲、URL形式を検証。エラー表示は日本語。 | Must | 異常系テストケースでエラーメッセージが表示される |
| F-03 | 計算エンジン | タリフテーブル + カスタム係数 + 税率を適用。課税/非課税の切替に対応。 | Must | 単体テストで主要パターン（10ケース）を検証 |
| F-04 | PDF生成 | A4縦、ブランドカラー対応。表紙・明細・備考の3セクション。 | Must | HTMLテンプレート変更後もSnapshotテストが成功 |
| F-05 | 匿名保存 | ローカル保存（LocalStorage）とクラウド保存を併用。クラウドは上書き保存。 | Must | 5分以内に保存結果が反映され、再読込で復元 |
| F-06 | 共有リンク管理 | 署名付きURL、有効期限設定、更新の強制失効が可能。 | Should | 期限切れのURLアクセスでエラーページを返却 |
| F-07 | 料金テーブル管理 | JSON定義を読み込み、UI上でも参照可能にする。 | Could | 管理者向けプレビューが表示される |

### 6.3 業務フロー（ハイレベル）
1. 利用者がトップページから「見積を作成」を選択。
2. ヒアリングフォームで情報を入力。各ステップ完了時に自動保存。
3. 計算エンジンがサーバーで料金を算出し、リアルタイムにサマリを表示。
4. 利用者がPDFを生成し、ダウンロードまたは署名付きURLで共有。
5. 案件データはクラウドに保存され、後から再編集可能。

---

## 7. 非機能要件
| カテゴリ | 要件 | 指標/基準 |
|----------|------|-----------|
| パフォーマンス | 主要操作のレスポンスは500ms以内。PDF生成は10秒以内。 | Lighthouse Performance 90点以上 |
| 可用性 | Vercel稼働率99.5%以上を前提。障害時はステータスページで通知。 | SLA 99.5% |
| 保守性 | ESLint + Prettier + 型定義で静的解析。StorybookでUI回帰を検知。 | CIでLint/Test必須 |
| セキュリティ | HTTPS必須。署名付きURLは最長14日で失効。リクエストはRate Limiterで制御。 | OWASP Top 10対策済み |
| ログ/監査 | 重要操作（保存、共有、PDF生成）の監査ログをNIFTY Functionsで記録。 | 監査ログ7日保持 |
| 国際化 | UIテキストは日本語固定。将来の英語対応に備え、i18n辞書を導入。 | JSON辞書管理 |

---

## 8. データ要件
### 8.1 エンティティ定義
| エンティティ | 主キー | 主な属性 | 備考 |
|--------------|--------|----------|------|
| Project | projectId（UUID） | createdAt, updatedAt, tariffVersion, totalAmount, currency | 案件基本情報 |
| ClientProfile | projectId | goal, targetPersona, industry, launchDate, budgetCeiling | ヒアリング結果 |
| Composition | componentId（UUID） | projectId, type, quantity, unitPrice, subtotal | 構成要素 |
| Option | optionId（UUID） | projectId, optionCode, multiplier, notes | オプション追加 |
| ShareToken | tokenId（UUID） | projectId, expiresAt, revokedAt, accessCount | 共有リンク |

### 8.2 料金テーブル構造
- 	ariffs.json に基本単価・オプション・係数を定義。
- バージョン番号を持ち、更新時はSemantic Versioningを採用。
- 計算時はバージョンをProjectに保持し、過去データとの整合性を維持。

### 8.3 データ保持ポリシー
- クラウド保存データは30日で自動削除。延長設定は今後の拡張事項。
- ローカル保存はユーザー操作で削除可能。
- 監査ログは7日保持後、統計値のみ残す。

---

## 9. 外部インターフェース要件
### 9.1 NIFTY Cloud mBaaS API
| API | メソッド | 用途 | 制約 |
|-----|----------|------|------|
| DataStore/Classes/{className} | POST | 案件データの新規保存 | 1MB以下/件 |
| DataStore/Classes/{className}/{id} | PUT | 案件データの更新 | 悲観ロックを回避するため更新日時チェック |
| Files | POST | PDFテンプレートや添付ファイルの保存 | 5MB以下/件 |
| Functions/execute | POST | 署名付きURLの発行、ログ記録 | Rate Limit 60req/min |

### 9.2 UI/UXガイドライン
- モバイル幅（375px）とデスクトップ幅（1440px）でレイアウト崩れがないこと。
- カラーパレットはブランドカラー（#2F88FF）を基調に3階調まで。
- フォントはNoto Sans JP、本文16px以上。

### 9.3 PDF出力仕様
- A4縦、余白上下18mm、左右15mm。
- 表紙に案件名・作成日・概算金額を表示。
- 明細は最大30行まで1ページに収める。超過時はページを分割。

---

## 10. セキュリティ・プライバシー要件
- 匿名IDをブラウザに保存する際はUUIDv7を使用し、32文字のランダム値とする。
- 共有リンクはAES-256で暗号化したペイロードを署名付きURLに埋め込む。
- PDFにはウォーターマークとして案件IDを透かしで表示する。
- 個人情報の取得は原則なし。ただし自由入力に個人情報が含まれる可能性を想定し、保存データはTLS1.2以上で転送する。

---

## 11. 運用・サポート要件
- 監視: Vercel Analytics + Sentry + Slack通知を利用。
- 障害対応: 1次切り分けは開発チーム、重大障害はプロダクトオーナー報告。
- バックアップ: NIFTY Cloud自動バックアップを有効化し、週次で整合性確認。
- ドキュメント: Notionに手順書・FAQを整備し、更新はPull Requestと連動。

---

## 12. 受入基準
| 項目 | 基準 |
|------|------|
| 機能テスト | 機能要件テーブルのMust/Should項目が全て合格していること |
| UX検証 | 5名のユーザビリティテストで致命的課題（Severity A）が0件 |
| パフォーマンス | Lighthouse Performance 90点、Core Web Vitals「Good」 |
| セキュリティ | OWASP ZAPスキャンでHighリスク脆弱性0件 |
| ドキュメント | ユーザーガイド・API概要・料金テーブル定義が最新化 |

---

## 13. テスト方針
- 単体テスト: 計算エンジン、バリデーション、ユーティリティを対象にVitestで自動化。
- 統合テスト: フォーム投入〜PDF生成までをPlaywrightで自動化。
- 回帰テスト: Storybook + ChromaticでUI差分を検証。
- 手動テスト: 料金テーブル差し替え時のスポットチェック。

---

## 14. リスクと未確定事項
| ID | リスク/課題 | 状態 | 対応策 |
|----|--------------|------|--------|
| R1 | 無料枠を超えるAPIコール | 未対応 | 利用上限アラートとキャッシュ戦略を検討 |
| R2 | 匿名共有による情報漏えい懸念 | 対応中 | ウォーターマーク・期限付きURLで抑止 |
| R3 | PDFテンプレートの多言語対応 | 未対応 | i18n辞書導入時にテンプレート分岐を設計 |
| R4 | 料金テーブルの正確性 | 進行中 | 市場調査と外部アドバイザー監修を実施 |

---

## 15. 承認
- 本要件定義書は、プロダクトオーナーとテックリードの承認をもって確定とする。
- 変更はChange Requestを提出し、影響範囲分析と再承認を経て反映する。

---

## 16. ヒアリングシート拡充（ユーザー視認性・操作性を重視）
本節は実装時の質問セット定義（`form-options.ts`）、バリデーション（`validation/estimate.ts`）およびPDF文言との整合に資する拡張案です。重複を避け、既存項目（目的/構成/オプション/費用）と統合できる形で提示します。

### 16.1 記入ガイド
- 必須項目は必ずご記入ください／該当する項目にチェックを入れてください／不明点はお問い合わせください。

### 16.2 基本情報（必須中心）
- 会社名・団体名（必須）／ご担当者名（必須）／役職・部署／メール（必須）／電話（必須）／所在地／業種（選択＋その他記述）／従業員数（区分）

### 16.3 プロジェクト概要
- 目的（複数選択）: 新規顧客獲得／認知向上／採用強化／問い合わせ増／EC／差別化／信頼性 ほか＋自由記述
- サイト種別（必須）: 企業／EC／サービス／LP／メディア／採用／ポートフォリオ／その他
- 想定ページ数（必須）: 1P（LP）／2–5／6–10／11–20／21–50／51+／未定
- 構成要望（自由記述）: 例）トップ／会社概要／サービス紹介／お問い合わせ 等

### 16.4 ターゲット・ブランド
- ターゲット: 性別／年齢層（複選）／特徴・属性（自由記述）
- ブランドイメージ（単一選択）: 革新的／上質／親しみ／信頼 など12択
- 価値観（複選）: 創造性／品質／信頼／独自性 等
- 目指す姿（複選）: 新しい挑戦／満足追求／価値向上／社会的責任 等

### 16.5 競合・差別化
- 競合の良い点（複選）: デザイン／情報の分かりやすさ／使いやすさ／更新頻度／SEO／速度
- 競合URLと詳細（任意）
- 競合の改善点（複選）: デザインが古い／情報が分かりにくい／更新されていない／SEO不足／遅い 等
- 自社の強み（複選＋自由記述）: 価格／品質／スピード／専門性／信頼／サポート／実績／地域密着／ワンストップ 等
- 差別化アイデア（自由記述）

### 16.6 予算・スケジュール
- 予算（必須）: 金額＋確定/概算/未定／補足（分割・段階制作 等）
- 希望納期（必須）: 1/2/3/6か月以内／未指定＋具体日

### 16.7 現状サイト
- 有無／URL／課題（複選）: デザインが古い／未レスポンシブ／更新困難／アクセス/問い合わせ少／遅い／SEO不足／情報が古い／その他
- 月間アクセス帯（選択）

### 16.8 デザイン要望・参考
- 参考サイトURLと理由／避けたいサイト・理由
- デザインテイスト（複選）: シンプル／モダン／高級感／親しみ／インパクト／クラシック／ポップ／先進的
- カラー（複選＋自由指定）: 系統選択＋コーポレートカラー
- ロゴデータ: あり（AI/EPS, PNG/JPG）／なし／制作希望
- 画像素材: 商品／人物／店舗／イメージ／パンフ等／提供困難（自由記述）
- 素材不足時: 撮影依頼／ストック／自社手配／相談

### 16.9 機能要件
- 基本機能（複選）: 問い合わせ／資料請求／見積依頼／予約／ニュース／ブログ／FAQ／会社概要／アクセス／スタッフ ほか
- 高度機能（複選）: EC／会員／決済／多言語／検索／チャットボット／メルマガ／CRM
- CMS希望（分岐）: ヘッドレス／Notion連携／独自管理画面／不要（静的）／相談
- 更新方法/頻度: 自社更新／委託／併用／相談 ＋ ほぼ毎日〜ほとんどなし

### 16.10 SEO・マーケ
- 重要度（段階）／狙いたいキーワード（自由）
- 実施中施策（複選）: リスティング／SNS広告／SEO／SNS運用／メール／チラシ 等
- SNS連携（複選）: Facebook／Instagram／X／LINE／YouTube／LinkedIn
- GA4・Search Console: 希望／既に使用／不要／不明

### 16.11 技術・インフラ
- ドメイン: 既存／新規／相談＋既存ドメイン名
- サーバー: まかせる／既存利用／自社用意／相談
- SSL: 必要／不要／不明
- 対応デバイス: PC／スマホ／タブレット

### 16.12 保守・運用
- 契約形態: 月額保守／都度依頼／不要／相談
- バックアップ: 必要／不要／不明
- セキュリティ重要度: 非常に重要〜標準

### 16.13 進行・その他
- 決裁・承認フロー: 最終決裁／上長承認／複数検討／その他（詳細）
- 制作会社経験: 初回／あり（満足/不満）＋良かった点/悪かった点
- 重視点（複選）: デザイン／技術／提案／レスポンス／価格／サポート／実績／業界理解
- その他要望・特記事項／シートへの要望

注記
- 既存の基本ステップ（基本情報／構成／オプション／サマリ）にマッピングし、分岐表示で負担を最小化します。
- 重複を避け、SEOやブログ要件は「ワードプレス実装」に統合済み。マーケ支援はGA4+SNSのパックで簡素化します。